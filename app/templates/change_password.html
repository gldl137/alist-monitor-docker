<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改密码 - Alist 监控系统</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='0' y='0' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='37' y='0' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='74' y='0' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='0' y='37' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='37' y='37' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='74' y='37' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='0' y='74' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='37' y='74' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3Crect x='74' y='74' width='26' height='26' rx='3' fill='%234F46E5'/%3E%3C/svg%3E">
    <link href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        monitor: '#10B981',
                        card: '#FFFFFF',
                        'card-border': '#E2E8F0',
                        'status-success': '#10B981',
                        'status-warning': '#F59E0B',
                        'status-error': '#EF4444',
                        'primary-light': '#EEF2FF',
                        'secondary-light': '#D1FAE5',
                        'warning-light': '#FEF3C7',
                        'danger-light': '#FEE2E2'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 8px 24px rgba(0, 0, 0, 0.1)',
                        'btn': '0 4px 6px -1px rgba(79, 70, 229, 0.3)',
                        'btn-hover': '0 10px 15px -3px rgba(79, 70, 229, 0.4)',
                    }
                }
            }
        };
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .card-design {
                @apply bg-card rounded-2xl border border-card-border shadow-card transition-all duration-300 hover:shadow-card-hover p-6;
            }

            .btn-action {
                @apply px-4 py-2 rounded-xl transition-all duration-200 flex items-center text-sm font-medium shadow-sm hover:shadow-md active:scale-[0.98];
            }

            .btn-sm {
                @apply px-3 py-1.5 text-xs;
            }

            .status-badge {
                @apply px-2.5 py-1 rounded-full text-xs font-medium flex items-center;
            }

            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            .monitor-active {
                @apply bg-monitor text-white shadow-md hover:shadow-lg transition-all duration-300;
            }

            .monitor-inactive {
                @apply bg-gray-100 text-gray-800 shadow-sm hover:shadow transition-all duration-300 px-2.5 py-1 text-xs;
            }

            .storage-row {
                @apply hover:bg-gray-50 transition-colors duration-200;
            }

            .status-badge-success {
                @apply bg-status-success/10 text-status-success;
            }

            .status-badge-warning {
                @apply bg-status-warning/10 text-status-warning;
            }

            .status-badge-error {
                @apply bg-status-error/10 text-status-error animate-pulse-slow;
            }

            .status-badge-neutral {
                @apply bg-gray-100 text-gray-800;
            }

            .mobile-center {
                @apply text-center;
            }

            .btn-outline {
                @apply border border-gray-300 text-gray-600 rounded-full px-2.5 py-1 text-xs hover:bg-gray-50 transition-colors duration-200;
            }

            .notification-item {
                @apply p-4 rounded-xl border border-gray-100 bg-gray-50 shadow-sm hover:shadow transition-all duration-200 hover:-translate-y-1;
            }

            .btn-primary {
                @apply bg-primary/90 text-white hover:bg-primary transition-all duration-300 shadow-btn hover:shadow-btn-hover transform hover:-translate-y-0.5;
            }

            .btn-secondary {
                @apply bg-secondary/90 text-white hover:bg-secondary;
            }

            .btn-danger {
                @apply bg-danger/90 text-white hover:bg-danger;
            }

            .btn-gray {
                @apply bg-gray-200 text-gray-700 hover:bg-gray-300;
            }

            .input-control {
                @apply pl-10 w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200;
            }

            .section-title {
                @apply text-xl font-bold mb-5 flex items-center;
            }

            .form-label {
                @apply block text-sm font-medium text-gray-700 mb-2;
            }

            .module-header {
                @apply flex items-center justify-between mb-4;
            }

            .module-title {
                @apply text-lg font-semibold text-primary flex items-center gap-2;
            }

            .stats-card {
                @apply p-5 rounded-xl shadow-sm hover:shadow transition-all duration-300 flex flex-col items-center justify-center;
            }

            .stats-icon {
                @apply text-2xl mb-2;
            }

            .login-card {
                @apply bg-white rounded-3xl shadow-lg p-8 max-w-md w-full mx-4 transform transition-all duration-500 hover:shadow-xl;
            }

            .login-title {
                @apply text-2xl font-bold text-primary mb-6 flex items-center justify-center;
            }

            .form-input-group {
                @apply mb-5 relative;
            }

            .form-icon {
                @apply absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400;
            }

            .login-button {
                @apply w-full py-3 px-4 bg-primary text-white rounded-2xl font-medium transition-all duration-300 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary/50 active:scale-[0.98] shadow-lg hover:shadow-xl transform hover:-translate-y-0.5;
            }

            .login-button-loading {
                @apply bg-primary/70 cursor-not-allowed;
            }

            .toast-success {
                @apply bg-green-600;
            }

            .toast-error {
                @apply bg-red-600;
            }

            .toast-warning {
                @apply bg-yellow-600;
            }

            .toast-info {
                @apply bg-blue-600;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-primary-light font-inter text-dark min-h-screen flex items-center justify-center p-4">
    <div class="fixed -top-20 -right-20 w-64 h-64 bg-primary/10 rounded-full blur-3xl"></div>
    <div class="fixed -bottom-32 -left-20 w-80 h-80 bg-secondary/10 rounded-full blur-3xl"></div>
    
    <div class="login-card relative z-10">
        <div class="login-title">
            <i class="fa fa-lock text-3xl mr-3 text-primary/80"></i>
            <span>修改密码</span>
        </div>
        
        <div class="text-center text-gray-500 mb-8">
            <p>请输入当前密码和新密码</p>
        </div>
        
        <form id="change-password-form" class="space-y-5">
            <div class="form-input-group">
                <div class="form-icon">
                    <i class="fa fa-key"></i>
                </div>
                <input type="password" id="old-password" name="old-password" class="input-control" placeholder="请输入旧密码" required>
            </div>
            
            <div class="form-input-group">
                <div class="form-icon">
                    <i class="fa fa-key"></i>
                </div>
                <input type="password" id="new-password" name="new-password" class="input-control" placeholder="请输入新密码" required>
            </div>
            
            <div class="form-input-group">
                <div class="form-icon">
                    <i class="fa fa-key"></i>
                </div>
                <input type="password" id="confirm-password" name="confirm-password" class="input-control" placeholder="请再次输入新密码" required>
            </div>
            
            <button type="submit" id="change-password-button" class="login-button">
                <i class="fa fa-save mr-2"></i>保存更改
            </button>
        </form>
        
        <div class="mt-8 text-center text-gray-400 text-sm">
            <p class="flex items-center justify-center">
                <i class="fa fa-th-large mr-2 text-primary/80"></i>
                <span>AlistMonitor v1.0.2 - by：<a href="http://www.coolapk.com/u/517019" target="_blank" class="text-primary hover:underline">YUAI</a>（2025）</span>
            </p>
        </div>
    </div>
    
    <div id="toast" class="fixed bottom-6 right-6 px-5 py-3 rounded-xl shadow-lg transform translate-y-10 opacity-0 transition-all duration-500 flex items-center z-50 max-w-sm">
        <i id="toast-icon" class="fa fa-check-circle mr-3 text-white"></i>
        <span id="toast-message" class="text-sm text-white"></span>
    </div>
    
    <script>
        document.getElementById('change-password-form').addEventListener('submit', function (event) {
            event.preventDefault();
            
            const form = event.target;
            const changePasswordButton = document.getElementById('change-password-button');
            const originalButtonText = changePasswordButton.innerHTML;
            
            // 验证表单
            const oldPassword = document.getElementById('old-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!oldPassword || !newPassword || !confirmPassword) {
                showToast('请填写所有字段', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('两次输入的新密码不一致', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('新密码长度至少为6个字符', 'error');
                return;
            }
            
            // 显示加载状态
            changePasswordButton.disabled = true;
            changePasswordButton.classList.add('login-button-loading');
            changePasswordButton.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>处理中...';
            
            fetch('/api/change_password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ old_password: oldPassword, new_password: newPassword })
            })
            .then(response => response.json())
            .then(data => {
                // 恢复按钮状态
                changePasswordButton.disabled = false;
                changePasswordButton.classList.remove('login-button-loading');
                changePasswordButton.innerHTML = originalButtonText;
                
                if (data.success) {
                    showToast(data.message, 'success');
                    // 延迟跳转以显示成功消息
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1500);
                } else {
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('修改密码失败:', error);
                // 恢复按钮状态
                changePasswordButton.disabled = false;
                changePasswordButton.classList.remove('login-button-loading');
                changePasswordButton.innerHTML = originalButtonText;
                showToast('修改密码失败，请稍后重试', 'error');
            });
        });

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastMessage = document.getElementById('toast-message');
            
            // 移除所有类型类
            toast.classList.remove('toast-success', 'toast-error', 'toast-warning', 'toast-info');
            
            // 添加适当的类型类
            if (type === 'success') {
                toast.classList.add('toast-success');
                toastIcon.className = 'fa fa-check-circle mr-3 text-white';
            } else if (type === 'error') {
                toast.classList.add('toast-error');
                toastIcon.className = 'fa fa-times-circle mr-3 text-white';
            } else if (type === 'warning') {
                toast.classList.add('toast-warning');
                toastIcon.className = 'fa fa-exclamation-triangle mr-3 text-white';
            } else {
                toast.classList.add('toast-info');
                toastIcon.className = 'fa fa-info-circle mr-3 text-white';
            }

            toastMessage.textContent = message;
            
            // 显示toast
            toast.classList.remove('opacity-0', 'translate-y-10');
            
            // 定时隐藏
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }
    </script>
</body>
</html>